clc; clear;

% 设置图像文件夹路径（与 preprocessing 同级）
imageFolder = fullfile('Data', 'Frauenkirche');

% 获取所有图像文件名，按时间顺序排序
imageFiles = dir(fullfile(imageFolder, '*.jpg'));
imageList = sort({imageFiles.name});

if isempty(imageList)
    error('❌ 没有在 %s 中找到图像文件，请检查路径和文件命名！', imageFolder);
end

% 执行图像配准（逐对配准）
[alignedImages, transformParams] = register_images(imageFolder, imageList);

% 展示第一幅图像
figure; imshow(alignedImages{1}, []);
title('First Aligned Image');

% 展示最后一幅图像
validIdx = find(~cellfun(@isempty, alignedImages));
if length(validIdx) >= 2
    first = alignedImages{validIdx(1)};
    last = alignedImages{validIdx(end)};
    
    % 可选差异图（用于调试/展示）
    % show_difference(first, last, 'Difference: First vs. Last');
    
    figure; imshowpair(first, last);
    title('Overlay: First vs. Last');
end

fprintf("✅ Test finished. %d / %d images successfully aligned.\n", ...
    sum(~cellfun(@isempty, alignedImages)), length(imageList));
